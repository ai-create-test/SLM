# ğŸ”¬ NeuralFlow æ¶æ„æ·±åº¦åˆ†æä¸å¼€å‘çŠ¶æ€è¯„ä¼°

> **ä»»åŠ¡ç­‰çº§**: A02 - æœ€é«˜ä¼˜å…ˆçº§  
> **åˆ†ææ—¥æœŸ**: 2026-01-15 (æ›´æ–°)  
> **æ–‡æ¡£ç›®çš„**: å¯¹æ¯”åŸå§‹æ¶æ„è®¾æƒ³ä¸ç°æœ‰å®ç°ï¼Œè¯„ä¼°æ¨¡å—å®Œæˆåº¦ï¼Œè§„åˆ’ä¸‹ä¸€æ­¥å¼€å‘

---

## ğŸ“‹ ç›®å½•

1. [åŸå§‹è®¾æƒ³å›é¡¾](#1-åŸå§‹è®¾æƒ³å›é¡¾)
2. [å½“å‰å®ç°åˆ†æ](#2-å½“å‰å®ç°åˆ†æ)
3. [æ¨¡å—å®Œæˆåº¦è¯„ä¼°](#3-æ¨¡å—å®Œæˆåº¦è¯„ä¼°)
4. [å·®å¼‚å¯¹ç…§ä¸è¿›å±•](#4-å·®å¼‚å¯¹ç…§ä¸è¿›å±•)
5. [æ ¸å¿ƒæ¶æ„æµç¨‹å›¾](#5-æ ¸å¿ƒæ¶æ„æµç¨‹å›¾)
6. [ä¸‹ä¸€æ­¥å¼€å‘è§„åˆ’](#6-ä¸‹ä¸€æ­¥å¼€å‘è§„åˆ’)
7. [é£é™©ä¸å»ºè®®](#7-é£é™©ä¸å»ºè®®)

---

## 1. åŸå§‹è®¾æƒ³å›é¡¾

### 1.1 äº”å¤§æ ¸å¿ƒæ¨¡å—è®¾è®¡

| # | æ¨¡å—åç§° | æ ¸å¿ƒæœºåˆ¶ | æ ¸å¿ƒéœ€æ±‚ |
|---|----------|----------|----------|
| 1 | **è¾“å…¥/è¾“å‡ºå±‚** | è¯­ä¹‰å‹ç¼©æœº (VQ-VAE / 1D-CNN) | æ®µè½çº§å‹ç¼©å‘é‡ï¼Œæ‹’ç»é€å­—é¢„æµ‹ |
| 2 | **è®°å¿†å±‚** | æ½œå˜é‡æ£€ç´¢ (Latent Retrieval) | å†å²å‘é‡å­˜å‚¨ + Cross-Attention èåˆ |
| 3 | **æ ¸å¿ƒå¤§è„‘** | åŠ¨æ€åŠ¨åŠ›å­¦æ¨¡å‹ (Mamba/GRU) | æ½œç©ºé—´é¢„æµ‹ä¸‹ä¸€æ®µè½å‘é‡ |
| 4 | **æ€è€ƒæœºåˆ¶** | ACT è‡ªé€‚åº”è®¡ç®—æ—¶é—´ | åŠ¨æ€ Thinking Loop + Halt Unit |
| 5 | **æƒ…æ„Ÿæ§åˆ¶** | AdaLN / FiLM | Î³(e)Â·z + Î²(e) æ·±åº¦è°ƒåˆ¶ |

### 1.2 å…­å¤§æ ¸å¿ƒéœ€æ±‚

1. **åŸºäºæœ€å…ˆè¿› LLM æ¶æ„** (ä½†éä¼ ç»Ÿ Transformer è‡ªå›å½’)
2. **é—®é¢˜å¯¼å‘çš„å¢å¼ºæ£€ç´¢é˜…è¯»** - æ ¹æ®ç”¨æˆ·é—®é¢˜åŠ¨æ€è°ƒæ•´ç†è§£ä¾§é‡ç‚¹
3. **ç±»å›¾å­˜å‚¨ + æƒ…æ„Ÿå‘é‡** - ç»“æ„åŒ–çŸ¥è¯†æš‚å­˜
4. **è‡ªæˆ‘å›æº¯è®¾è®¡** - æ¨¡å‹å¯å›é¡¾å’Œä¿®æ­£æ¨ç†
5. **è”ç½‘æœç´¢æ¨¡å—** - å®æ—¶å¤–éƒ¨çŸ¥è¯†æ¥å…¥
6. **é«˜åº¦æ‰©å±•æ€§ + æ¨¡å—åŒ–** - å³æ’å³ç”¨çš„ç»„ä»¶è®¾è®¡

---

## 2. å½“å‰å®ç°åˆ†æ

### 2.1 é¡¹ç›®ç»“æ„æ¦‚è§ˆ

```
gemini_test/
â”œâ”€â”€ app/                           æ€»è®¡ 68 ä¸ª Python æ–‡ä»¶
â”‚   â”œâ”€â”€ core/                      âœ… å®Œæ•´å®ç° (4 files)
â”‚   â”‚   â”œâ”€â”€ tokenizer_base.py      åˆ†è¯å™¨æŠ½è±¡åŸºç±»
â”‚   â”‚   â”œâ”€â”€ bpe_tokenizer.py       BPEåˆ†è¯å™¨ (åŸºäºtiktoken)
â”‚   â”‚   â”œâ”€â”€ tokenizer_attention.py BM25/TF-IDF é—®é¢˜å¯¼å‘æƒé‡
â”‚   â”‚   â””â”€â”€ tokenizer_factory.py   å·¥å‚æ¨¡å¼
â”‚   â”‚
â”‚   â”œâ”€â”€ io/                        âœ… å®Œæ•´å®ç° (7 files, ~15KB+)
â”‚   â”‚   â”œâ”€â”€ paragraph_encoder.py   VQ-VAE æ®µè½ç¼–ç å™¨ (394 lines)
â”‚   â”‚   â”œâ”€â”€ paragraph_decoder.py   æ¡ä»¶è§£ç å™¨ (453 lines)
â”‚   â”‚   â”œâ”€â”€ vq_codebook.py         å‘é‡é‡åŒ–ç æœ¬ (10KB)
â”‚   â”‚   â”œâ”€â”€ semantic_segmenter.py  è¯­ä¹‰æ®µè½åˆ†å‰²
â”‚   â”‚   â”œâ”€â”€ base_lm.py             åŸºç¡€è¯­è¨€æ¨¡å‹å°è£…
â”‚   â”‚   â””â”€â”€ tokenizer_wrapper.py   åˆ†è¯å™¨åŒ…è£…å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ memory/                    âœ… å®Œæ•´å®ç° (9 files, ~12KB+)
â”‚   â”‚   â”œâ”€â”€ latent_memory_bank.py  FAISS æ½œå‘é‡è®°å¿†åº“ (369 lines)
â”‚   â”‚   â”œâ”€â”€ cross_attention_fuser.py Cross-Attention è®°å¿†èåˆ (187 lines)
â”‚   â”‚   â”œâ”€â”€ graph_memory.py        ç±»å›¾çŸ¥è¯†å­˜å‚¨ (309 lines)
â”‚   â”‚   â”œâ”€â”€ query_retriever.py     é—®é¢˜å¯¼å‘æ£€ç´¢
â”‚   â”‚   â”œâ”€â”€ embeddings.py          TokenåµŒå…¥ + RoPE
â”‚   â”‚   â”œâ”€â”€ fusion.py              æƒ…æ„Ÿ/åœºæ™¯é—¨æ§èåˆ
â”‚   â”‚   â””â”€â”€ text_chunker.py        é•¿æ–‡æœ¬åˆ†å—
â”‚   â”‚
â”‚   â”œâ”€â”€ brain/                     âœ… å®Œæ•´å®ç° (8 files, ~20KB+)
â”‚   â”‚   â”œâ”€â”€ dynamics_model.py      Mamba/GRU åŠ¨åŠ›å­¦æ¨¡å‹ (454 lines)
â”‚   â”‚   â”œâ”€â”€ act_controller.py      ACT è‡ªé€‚åº”è®¡ç®—æ—¶é—´ (252 lines)
â”‚   â”‚   â”œâ”€â”€ halt_unit.py           åœæ­¢å†³ç­–ç¥ç»å…ƒ
â”‚   â”‚   â”œâ”€â”€ reasoning_loop.py      æ€è€ƒå¾ªç¯åè°ƒ (255 lines)
â”‚   â”‚   â”œâ”€â”€ modulated_dynamics.py  å¸¦æƒ…æ„Ÿè°ƒåˆ¶çš„åŠ¨åŠ›å­¦æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ modulated_mamba.py     æƒ…æ„Ÿè°ƒåˆ¶ Mamba å—
â”‚   â”‚   â””â”€â”€ modulated_reasoning_loop.py å®Œæ•´è°ƒåˆ¶æ¨ç†å¾ªç¯
â”‚   â”‚
â”‚   â”œâ”€â”€ modulation/                âœ… å®Œæ•´å®ç° (5 files, ~7KB+)
â”‚   â”‚   â”œâ”€â”€ adaln.py               è‡ªé€‚åº”å±‚å½’ä¸€åŒ– (260 lines)
â”‚   â”‚   â”œâ”€â”€ film.py                FiLM è°ƒåˆ¶å±‚
â”‚   â”‚   â”œâ”€â”€ emotion_encoder.py     æƒ…æ„ŸçŠ¶æ€ç¼–ç 
â”‚   â”‚   â””â”€â”€ scene_encoder.py       åœºæ™¯æ¨¡å¼ç¼–ç 
â”‚   â”‚
â”‚   â”œâ”€â”€ reflection/                âœ… åŸºç¡€å®ç° (4 files)
â”‚   â”‚   â”œâ”€â”€ trajectory_logger.py   æ¨ç†è½¨è¿¹è®°å½• (4.7KB)
â”‚   â”‚   â”œâ”€â”€ backtracker.py         å›æº¯æ‰§è¡Œå™¨ (154 lines)
â”‚   â”‚   â””â”€â”€ self_critic.py         è‡ªæˆ‘è¯„ä»·
â”‚   â”‚
â”‚   â”œâ”€â”€ search/                    âš ï¸ æ¡†æ¶å®ç° (5 files)
â”‚   â”‚   â”œâ”€â”€ search_interface.py    æœç´¢æŠ½è±¡æ¥å£
â”‚   â”‚   â”œâ”€â”€ web_search.py          Webæœç´¢ (DuckDuckGoå®ç°)
â”‚   â”‚   â”œâ”€â”€ knowledge_injector.py  çŸ¥è¯†æ³¨å…¥
â”‚   â”‚   â””â”€â”€ cache.py               æœç´¢ç¼“å­˜
â”‚   â”‚
â”‚   â”œâ”€â”€ training/                  âœ… å®Œæ•´å®ç° (4 files, ~14KB+)
â”‚   â”‚   â”œâ”€â”€ vqvae_trainer.py       VQ-VAE è®­ç»ƒå™¨ (423 lines)
â”‚   â”‚   â”œâ”€â”€ dynamics_trainer.py    åŠ¨åŠ›å­¦æ¨¡å‹è®­ç»ƒå™¨ (426 lines)
â”‚   â”‚   â””â”€â”€ data_loader.py         æ•°æ®åŠ è½½å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ interfaces/                âœ… å®Œæ•´å®ç° (4 files)
â”‚   â”‚   â”œâ”€â”€ base_module.py         æ¨¡å—åŸºç±» + LatentVector/MemoryItem
â”‚   â”‚   â”œâ”€â”€ config.py              å…¨å±€é…ç½® (8KB)
â”‚   â”‚   â””â”€â”€ registry.py            æ¨¡å—æ³¨å†Œè¡¨
â”‚   â”‚
â”‚   â””â”€â”€ pipeline.py                âœ… å®Œæ•´å®ç° (288 lines)
â”‚
â”œâ”€â”€ demo/
â”‚   â””â”€â”€ run_pipeline.py            âœ… ç«¯åˆ°ç«¯æ¼”ç¤ºè„šæœ¬ (214 lines)
â”‚
â””â”€â”€ tests/                         âœ… å®Œæ•´æµ‹è¯• (8 files, ~25KB+)
    â”œâ”€â”€ test_e2e_integration.py    ç«¯åˆ°ç«¯é›†æˆæµ‹è¯•
    â”œâ”€â”€ test_dynamics_training.py  åŠ¨åŠ›å­¦è®­ç»ƒæµ‹è¯•
    â”œâ”€â”€ test_vqvae_training.py     VQ-VAE è®­ç»ƒæµ‹è¯•
    â”œâ”€â”€ test_emotion_modulation.py æƒ…æ„Ÿè°ƒåˆ¶æµ‹è¯•
    â””â”€â”€ test_tokenizer.py          åˆ†è¯å™¨æµ‹è¯•
```

### 2.2 æŠ€æœ¯æ ˆæ€»ç»“

| ç»„ä»¶ | å½“å‰å®ç° | æŠ€æœ¯ç»†èŠ‚ | çŠ¶æ€ |
|------|----------|----------|------|
| åˆ†è¯ | tiktoken BPE | GPT-4 ç¼–ç ï¼Œ~100k è¯è¡¨ | âœ… å®Œæ•´ |
| ä½ç½®ç¼–ç  | RoPE | æ—‹è½¬ä½ç½®ç¼–ç  | âœ… å®Œæ•´ |
| å½’ä¸€åŒ– | RMSNorm | LLaMA é£æ ¼ | âœ… å®Œæ•´ |
| æ®µè½ç¼–ç  | VQ-VAE | å¤šå¤´é‡åŒ– + æ³¨æ„åŠ›æ± åŒ– | âœ… å®Œæ•´ |
| åŠ¨åŠ›å­¦æ¨¡å‹ | Mamba / GRU | é€‰æ‹©æ€§ SSM + å¤‡é€‰ GRU | âœ… å®Œæ•´ |
| è®°å¿†ç³»ç»Ÿ | FAISS + Cross-Attn | å‘é‡æ£€ç´¢ + èåˆ | âœ… å®Œæ•´ |
| ç±»å›¾å­˜å‚¨ | GraphMemory | èŠ‚ç‚¹/è¾¹/å­å›¾æ£€ç´¢ | âœ… å®Œæ•´ |
| æƒ…æ„Ÿè°ƒåˆ¶ | AdaLN + FiLM | Î³(e)Â·norm(x) + Î²(e) | âœ… å®Œæ•´ |
| ACT æ€è€ƒ | HaltUnit + Controller | åŠ¨æ€æ·±åº¦æ€è€ƒ | âœ… å®Œæ•´ |
| å›æº¯æœºåˆ¶ | Backtracker | è½¨è¿¹è®°å½• + å›é€€ | âœ… åŸºç¡€ |
| è”ç½‘æœç´¢ | WebSearch | DuckDuckGo é›†æˆ | âš ï¸ æ¡†æ¶ |

---

## 3. æ¨¡å—å®Œæˆåº¦è¯„ä¼°

### 3.1 è¯¦ç»†å®Œæˆåº¦è¯„åˆ†

| æ¨¡å— | è®¾è®¡ | ä»£ç  | æµ‹è¯• | é›†æˆ | æ€»åˆ† | è¯´æ˜ |
|------|:----:|:----:|:----:|:----:|:----:|------|
| **IO Layer** | â¬›â¬›â¬›â¬›â¬› | â¬›â¬›â¬›â¬›â¬› | â¬›â¬›â¬›â¬›â¬œ | â¬›â¬›â¬›â¬›â¬œ | **90%** | VQ-VAE å®Œæ•´ï¼Œç”Ÿæˆè´¨é‡å¾…ä¼˜åŒ– |
| **Memory Layer** | â¬›â¬›â¬›â¬›â¬› | â¬›â¬›â¬›â¬›â¬› | â¬›â¬›â¬›â¬œâ¬œ | â¬›â¬›â¬›â¬›â¬œ | **85%** | FAISS + Cross-Attn å®Œæ•´ |
| **Core Brain** | â¬›â¬›â¬›â¬›â¬› | â¬›â¬›â¬›â¬›â¬› | â¬›â¬›â¬›â¬›â¬œ | â¬›â¬›â¬›â¬›â¬œ | **90%** | Mamba/GRU åŒå®ç° |
| **ACT Thinking** | â¬›â¬›â¬›â¬›â¬› | â¬›â¬›â¬›â¬›â¬› | â¬›â¬›â¬›â¬œâ¬œ | â¬›â¬›â¬›â¬›â¬œ | **85%** | HaltUnit å®Œæ•´ï¼Œponder cost é›†æˆ |
| **Modulation** | â¬›â¬›â¬›â¬›â¬› | â¬›â¬›â¬›â¬›â¬› | â¬›â¬›â¬›â¬›â¬œ | â¬›â¬›â¬›â¬›â¬œ | **90%** | AdaLN + FiLM æ·±åº¦è°ƒåˆ¶ |
| **Graph Memory** | â¬›â¬›â¬›â¬›â¬œ | â¬›â¬›â¬›â¬›â¬› | â¬›â¬›â¬œâ¬œâ¬œ | â¬›â¬›â¬›â¬œâ¬œ | **70%** | åŸºç¡€å›¾æ“ä½œå®Œæ•´ï¼Œé›†æˆå¾…å®Œå–„ |
| **Reflection** | â¬›â¬›â¬›â¬›â¬œ | â¬›â¬›â¬›â¬›â¬œ | â¬›â¬›â¬œâ¬œâ¬œ | â¬›â¬›â¬œâ¬œâ¬œ | **60%** | æ¡†æ¶å®Œæ•´ï¼Œå®é™…ä½¿ç”¨å¾…éªŒè¯ |
| **Search** | â¬›â¬›â¬›â¬œâ¬œ | â¬›â¬›â¬›â¬›â¬œ | â¬›â¬œâ¬œâ¬œâ¬œ | â¬›â¬›â¬œâ¬œâ¬œ | **50%** | DuckDuckGo åŸºç¡€å®ç° |
| **Training** | â¬›â¬›â¬›â¬›â¬› | â¬›â¬›â¬›â¬›â¬› | â¬›â¬›â¬›â¬›â¬œ | â¬›â¬›â¬›â¬›â¬œ | **90%** | VQ-VAE + Dynamics è®­ç»ƒå™¨å®Œæ•´ |
| **Pipeline** | â¬›â¬›â¬›â¬›â¬› | â¬›â¬›â¬›â¬›â¬› | â¬›â¬›â¬›â¬œâ¬œ | â¬›â¬›â¬›â¬›â¬œ | **85%** | ç«¯åˆ°ç«¯æµæ°´çº¿å¯è¿è¡Œ |

### 3.2 æ•´ä½“å®Œæˆåº¦

```
åŸå§‹è®¾æƒ³å¯¹é½åº¦: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘ 80%
ä»£ç å®ç°å®Œæˆåº¦: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘ 85%
æµ‹è¯•è¦†ç›–å®Œæˆåº¦: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 65%
ç«¯åˆ°ç«¯å¯ç”¨æ€§:   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 75%

ç»¼åˆè¯„åˆ†: â­â­â­â­ (76% â†’ å¯ç”¨åŸå‹é˜¶æ®µ)
```

> [!IMPORTANT]
> ç›¸æ¯”ä¸Šä¸€ç‰ˆæœ¬åˆ†æï¼Œé¡¹ç›®å·²ä» **~5% æ¦‚å¿µéªŒè¯** è¿›å±•åˆ° **~75% å¯ç”¨åŸå‹**ï¼Œæ‰€æœ‰æ ¸å¿ƒæ¨¡å—å‡å·²å®ç°ã€‚

---

## 4. å·®å¼‚å¯¹ç…§ä¸è¿›å±•

### 4.1 åŸå§‹è®¾æƒ³ vs å½“å‰å®ç°å¯¹ç…§

| åŸå§‹è®¾æƒ³ | ä¸Šæ¬¡çŠ¶æ€ | å½“å‰çŠ¶æ€ | è¿›å±•è¯´æ˜ |
|----------|----------|----------|----------|
| **VQ-VAE æ®µè½å‹ç¼©** | ğŸ”´ æ—  | ğŸŸ¢ å®Œæ•´ | `ParagraphEncoder` (394è¡Œ) + `VQCodebook` å¤šå¤´é‡åŒ– |
| **æ½œå˜é‡æ£€ç´¢ (Latent Retrieval)** | ğŸ”´ æ—  | ğŸŸ¢ å®Œæ•´ | `LatentMemoryBank` (FAISS) + `CrossAttentionFuser` |
| **Mamba/GRU åŠ¨åŠ›å­¦** | ğŸ”´ æ—  | ğŸŸ¢ å®Œæ•´ | `DynamicsModel` æ”¯æŒ Mamba/GRU åŒå®ç° (454è¡Œ) |
| **ACT è‡ªé€‚åº”æ€è€ƒ** | ğŸ”´ æ—  | ğŸŸ¢ å®Œæ•´ | `ACTController` + `HaltUnit` + ponder cost |
| **AdaLN æƒ…æ„Ÿè°ƒåˆ¶** | ğŸŸ¡ æµ…å±‚åŠ æ³• | ğŸŸ¢ æ·±åº¦è°ƒåˆ¶ | `AdaptiveLayerNorm` Î³(e)Â·norm(x)+Î²(e) (260è¡Œ) |
| **ç±»å›¾çŸ¥è¯†å­˜å‚¨** | ğŸ”´ æ—  | ğŸŸ¢ å®Œæ•´ | `GraphMemory` èŠ‚ç‚¹/è¾¹/å­å›¾æ£€ç´¢ (309è¡Œ) |
| **è‡ªæˆ‘å›æº¯** | ğŸ”´ æ—  | ğŸŸ¡ åŸºç¡€ | `Backtracker` + `TrajectoryLogger` æ¡†æ¶å®Œæ•´ |
| **è”ç½‘æœç´¢** | ğŸ”´ æ—  | ğŸŸ¡ æ¡†æ¶ | `WebSearch` (DuckDuckGo) + `KnowledgeInjector` |
| **é—®é¢˜å¯¼å‘æ£€ç´¢** | ğŸŸ¡ åŸºç¡€ | ğŸŸ¢ å®Œæ•´ | `tokenizer_attention.py` BM25/TF-IDF + `QueryRetriever` |

### 4.2 å…³é”®æ”¹è¿›è¯¦è§£

#### âœ… æƒ…æ„Ÿè°ƒåˆ¶ä»æµ…å±‚åŠ æ³•å‡çº§ä¸ºæ·±åº¦ AdaLN

```python
# ä¹‹å‰ (æµ…å±‚åŠ æ³•)
output = embedding + gate * emotion_vector

# ç°åœ¨ (AdaLN æ·±åº¦è°ƒåˆ¶)
gamma = self.gamma_proj(emotion)  # æŠ•å½±å‡º scale
beta = self.beta_proj(emotion)     # æŠ•å½±å‡º shift
output = gamma * RMSNorm(x) + beta  # æ¯å±‚éƒ½è°ƒåˆ¶
```

#### âœ… æ ¸å¿ƒå¤§è„‘ä»æ— åˆ° Mamba SSM

```python
class MambaBlock(nn.Module):
    """é€‰æ‹©æ€§çŠ¶æ€ç©ºé—´æ¨¡å‹"""
    # h_t = A * h_{t-1} + B * x_t  (çŠ¶æ€æ›´æ–°)
    # y_t = C * h_t + D * x_t      (è¾“å‡º)
    # A, B, C æ˜¯è¾“å…¥ä¾èµ–çš„ (é€‰æ‹©æ€§æœºåˆ¶)
```

#### âœ… ç«¯åˆ°ç«¯æ¨ç†æµç¨‹å¯è¿è¡Œ

```
demo/run_pipeline.py æ¼”ç¤º:
1. demo_simple_generate()     - åŸºç¡€ç¼–ç â†’é¢„æµ‹â†’è§£ç 
2. demo_with_memory()         - è®°å¿†æ£€ç´¢å¢å¼ºç”Ÿæˆ
3. demo_with_emotion()        - æƒ…æ„Ÿè°ƒåˆ¶ç”Ÿæˆå¯¹æ¯”
```

---

## 5. æ ¸å¿ƒæ¶æ„æµç¨‹å›¾

### 5.1 å®Œæ•´æ¨ç†æµç¨‹

```mermaid
graph TB
    subgraph "è¾“å…¥å±‚ Input Layer"
        A[Raw Text] --> B[SemanticSegmenter]
        B --> C[ParagraphEncoder<br/>VQ-VAE]
        C --> D["z_t: LatentVector"]
    end
    
    subgraph "è®°å¿†å±‚ Memory Layer"
        E[LatentMemoryBank<br/>FAISS] -->|Top-K| F[Retrieved Memories]
        D -->|Query| E
        F --> G[CrossAttentionFuser]
        D --> G
        H[GraphMemory] -.->|Optional| G
    end
    
    subgraph "æ ¸å¿ƒå¤§è„‘ Core Brain"
        G --> I[ReasoningLoop]
        I --> J[DynamicsModel<br/>Mamba/GRU]
        J --> K[ACTController]
        K --> L{HaltUnit}
        L -->|Continue| J
        L -->|Stop| M["z_{t+1}: Predicted"]
    end
    
    subgraph "è°ƒåˆ¶å±‚ Modulation"
        N[EmotionEncoder] --> O[AdaLN]
        P[SceneEncoder] --> O
        O -.->|Each Layer| J
    end
    
    subgraph "è¾“å‡ºå±‚ Output Layer"
        M --> Q[ParagraphDecoder]
        Q --> R[Generated Text]
    end
    
    subgraph "åæ€å±‚ Reflection"
        S[TrajectoryLogger] -.-> T[Backtracker]
        T -.-> I
        U[SelfCritic] -.-> T
    end
    
    subgraph "æœç´¢å±‚ Search"
        V[WebSearch] --> W[KnowledgeInjector]
        W -.-> E
    end
    
    style D fill:#fff3cd
    style M fill:#d4edda
    style J fill:#cce5ff
    style O fill:#f8d7da
```

### 5.2 æ•°æ®æµè§„æ ¼

| é˜¶æ®µ | è¾“å…¥ | è¾“å‡º | ç»´åº¦ |
|------|------|------|------|
| åˆ†è¯ | Raw Text | token_ids | [batch, seq_len] |
| ç¼–ç  | token_ids | z_t (LatentVector) | [batch, d_latent] |
| è®°å¿†æ£€ç´¢ | query z_t | memory_vectors | [batch, k, d_latent] |
| è®°å¿†èåˆ | z_t + memories | fused_z | [batch, d_latent] |
| åŠ¨åŠ›å­¦é¢„æµ‹ | z_sequence | z_{t+1} | [batch, d_latent] |
| ACT å¾ªç¯ | state (1~Næ­¥) | final_state | [batch, d_model] |
| è§£ç  | z_{t+1} + emotion | text | string |

---

## 6. ä¸‹ä¸€æ­¥å¼€å‘è§„åˆ’

### 6.1 ä¼˜å…ˆçº§æ’åº

> [!TIP]
> ä»¥ä¸‹æŒ‰ **ä»·å€¼/æˆæœ¬** æ¯”æ’åºï¼Œå»ºè®®æŒ‰é¡ºåºæ‰§è¡Œ

| ä¼˜å…ˆçº§ | ä»»åŠ¡ | é¢„è®¡å·¥æœŸ | ä»·å€¼ | è¯´æ˜ |
|:------:|------|:--------:|:----:|------|
| **P0** | ç«¯åˆ°ç«¯è®­ç»ƒéªŒè¯ | 2-3å¤© | â­â­â­â­â­ | ä½¿ç”¨çœŸå®æ•°æ®éªŒè¯è®­ç»ƒæµç¨‹ |
| **P1** | è§£ç å™¨ç”Ÿæˆè´¨é‡ | 2å¤© | â­â­â­â­â­ | å½“å‰ç”Ÿæˆæ–‡æœ¬è´¨é‡ä¸ç¨³å®š |
| **P2** | è®°å¿†é›†æˆåˆ°æ¨ç† | 1-2å¤© | â­â­â­â­ | Pipeline ä¸­è®°å¿†ä½¿ç”¨ä¸å……åˆ† |
| **P3** | æœç´¢æ¨¡å—å®Œå–„ | 2å¤© | â­â­â­ | Google/Bing API + çŸ¥è¯†æ³¨å…¥ |
| **P4** | å›æº¯æœºåˆ¶å®æˆ˜ | 2å¤© | â­â­â­ | é›†æˆåˆ° ReasoningLoop |
| **P5** | å›¾è®°å¿†é›†æˆ | 2å¤© | â­â­â­ | GraphMemory èå…¥æ¨ç† |
| **P6** | æµ‹è¯•è¦†ç›–å®Œå–„ | 2-3å¤© | â­â­â­ | æé«˜æµ‹è¯•è¦†ç›–ç‡åˆ° 80% |

### 6.2 Phase D: ç”Ÿäº§åŒ–å°±ç»ª

#### D1. ç«¯åˆ°ç«¯è®­ç»ƒéªŒè¯ (P0)

```markdown
ç›®æ ‡: éªŒè¯å®Œæ•´è®­ç»ƒæµç¨‹å¯è¿è¡Œ

æ­¥éª¤:
1. å‡†å¤‡å°è§„æ¨¡è®­ç»ƒæ•°æ® (500-1000 æ®µè½)
2. è¿è¡Œ VQVAETrainer è®­ç»ƒç¼–ç å™¨
3. è¿è¡Œ DynamicsTrainer è®­ç»ƒåŠ¨åŠ›å­¦æ¨¡å‹
4. éªŒè¯è®­ç»ƒæŸå¤±æ”¶æ•›
5. ä¿å­˜/åŠ è½½æ£€æŸ¥ç‚¹æµ‹è¯•

éªŒè¯å‘½ä»¤:
    python -m tests.test_vqvae_training
    python -m tests.test_dynamics_training
```

#### D2. è§£ç å™¨ç”Ÿæˆè´¨é‡æ”¹è¿› (P1)

```markdown
å½“å‰é—®é¢˜:
- ç”Ÿæˆæ–‡æœ¬æœ‰æ—¶ä¸ºç©ºæˆ–æ— æ„ä¹‰
- æœªæ­£ç¡®ä½¿ç”¨æƒ…æ„Ÿæ¡ä»¶

æ”¹è¿›æ–¹å‘:
1. å¢åŠ  latent â†’ decoder çš„äº¤å‰æ³¨æ„åŠ›
2. å®ç° beam search / nucleus sampling
3. æ·»åŠ é‡å¤æƒ©ç½š
4. æ¡ä»¶ç”Ÿæˆ (emotion, scene) èå…¥è§£ç 
```

#### D3. è®°å¿†ç³»ç»Ÿå®Œæ•´é›†æˆ (P2)

```python
# ç›®æ ‡: åœ¨ NeuralFlowPipeline.generate() ä¸­å®Œæ•´ä½¿ç”¨è®°å¿†

# å½“å‰ (ç®€åŒ–)
z_input = encoder(text)
z_pred = dynamics(z_input)
output = decoder(z_pred)

# æ”¹è¿›å
z_input = encoder(text)
memories = memory_bank.retrieve(z_input, k=5)  # æ£€ç´¢è®°å¿†
z_fused = memory_fuser(z_input, memories)      # èåˆè®°å¿†
z_pred = reasoning_loop(z_fused, memories)     # è®°å¿†å‚ä¸æ¨ç†
output = decoder(z_pred, emotion, scene)       # æ¡ä»¶è§£ç 
memory_bank.add(z_pred, text)                  # æ›´æ–°è®°å¿†
```

### 6.3 å¾…å®ŒæˆåŠŸèƒ½æ¸…å•

```markdown
â–¡ ç«¯åˆ°ç«¯è®­ç»ƒæµç¨‹éªŒè¯
â–¡ è§£ç å™¨ç”Ÿæˆè´¨é‡æ”¹è¿›
â–¡ è®°å¿†ç³»ç»Ÿå®Œæ•´é›†æˆ
â–¡ Backtracker å®æˆ˜é›†æˆ
â–¡ GraphMemory æ¨ç†é›†æˆ
â–¡ Google/Bing Search API
â–¡ æ¨¡å‹ä¿å­˜/åŠ è½½å®Œå–„
â–¡ æ¨ç†é€Ÿåº¦ä¼˜åŒ–
â–¡ æ–‡æ¡£å®Œå–„
â–¡ æ€§èƒ½åŸºå‡†æµ‹è¯•
```

---

## 7. é£é™©ä¸å»ºè®®

### 7.1 æŠ€æœ¯é£é™©

| é£é™© | ä¸¥é‡åº¦ | å½“å‰çŠ¶æ€ | ç¼“è§£æªæ–½ |
|------|:------:|:--------:|----------|
| VQ-VAE codebook å´©å¡Œ | ä¸­ | âš ï¸ éœ€éªŒè¯ | ä½¿ç”¨ EMA update, reset dead codes |
| Mamba æ¨ç†æ•ˆç‡ | ä½ | âœ… å·²æœ‰ GRU å¤‡é€‰ | ç”Ÿäº§ç¯å¢ƒå¯åˆ‡æ¢ä¸º GRU |
| è§£ç ç”Ÿæˆè´¨é‡ | é«˜ | âš ï¸ è§‚å¯Ÿä¸­ | å¢å¼ºæ¡ä»¶èåˆï¼Œæ”¹è¿›é‡‡æ ·ç­–ç•¥ |
| é•¿æ–‡æœ¬å¤„ç† | ä¸­ | âœ… å·²æœ‰ Chunker | ç»§ç»­ä¼˜åŒ–æ®µè½è¾¹ç•Œæ£€æµ‹ |

### 7.2 æ¶æ„å»ºè®®

> [!IMPORTANT]
> **æ ¸å¿ƒå»ºè®®: ä¼˜å…ˆéªŒè¯ç«¯åˆ°ç«¯è®­ç»ƒ**
> 
> å½“å‰ä»£ç å·²è¾¾å¯ç”¨åŸå‹é˜¶æ®µï¼Œä½†æœªç»çœŸå®æ•°æ®è®­ç»ƒéªŒè¯ã€‚
> å»ºè®®ä½¿ç”¨ 1000 æ¡ä»¥ä¸Šæ®µè½æ•°æ®è¿›è¡Œå®Œæ•´è®­ç»ƒï¼ŒéªŒè¯:
> 1. VQ-VAE ç æœ¬åˆ©ç”¨ç‡
> 2. åŠ¨åŠ›å­¦æ¨¡å‹é¢„æµ‹å‡†ç¡®åº¦
> 3. è§£ç ç”Ÿæˆæ–‡æœ¬è´¨é‡

### 7.3 ä¿ç•™å¯å¤ç”¨ç»„ä»¶

| ç»„ä»¶ | çŠ¶æ€ | å»ºè®® |
|------|:----:|------|
| `BPETokenizer` | âœ… | ä¿ç•™ï¼Œå·¥ä¸šçº§å®ç° |
| `RoPE` | âœ… | ä¿ç•™ï¼Œç”¨äº Decoder |
| `RMSNorm` | âœ… | ä¿ç•™ï¼Œä½œä¸º AdaLN åŸºç¡€ |
| `TextChunker` | âœ… | ä¿ç•™ï¼Œå¯ç”¨äºè®­ç»ƒæ•°æ®é¢„å¤„ç† |
| `DynamicsModel` | âœ… | ä¿ç•™ï¼ŒMamba/GRU åŒå®ç° |
| `ACTController` | âœ… | ä¿ç•™ï¼Œè‡ªé€‚åº”è®¡ç®—å®Œæ•´ |
| `AdaptiveLayerNorm` | âœ… | ä¿ç•™ï¼Œæ·±åº¦æƒ…æ„Ÿè°ƒåˆ¶ |
| `LatentMemoryBank` | âœ… | ä¿ç•™ï¼ŒFAISS é›†æˆ |

### 7.4 èµ„æºè¯„ä¼° (æ›´æ–°)

| èµ„æº | ä¼°ç®— |
|------|------|
| å½“å‰ä»£ç é‡ | ~15,000 è¡Œ Python (å·²å®ç°) |
| å‰©ä½™å¼€å‘é‡ | ~2,000-3,000 è¡Œ |
| è®­ç»ƒ GPU | æ¨è RTX 4090 æˆ– A100 |
| å®Œæˆé¢„ä¼° | 2-4 å‘¨ (1äººå…¨èŒ) |
| ä¾èµ–åº“ | PyTorch, FAISS, mamba-ssm, tiktoken, duckduckgo-search |

---

## æ€»ç»“

### è¿›å±•è¯„ä¼° âœ…

å½“å‰ä»£ç åº“å·² **åŸºæœ¬å®ç°åŸå§‹è®¾æƒ³çš„æ‰€æœ‰æ ¸å¿ƒæ¨¡å—**ï¼š

1. âœ… VQ-VAE æ®µè½çº§è¯­ä¹‰å‹ç¼©
2. âœ… FAISS + Cross-Attention è®°å¿†ç³»ç»Ÿ
3. âœ… Mamba/GRU åŠ¨åŠ›å­¦é¢„æµ‹æ¨¡å‹
4. âœ… ACT è‡ªé€‚åº”è®¡ç®—æ—¶é—´
5. âœ… AdaLN æ·±åº¦æƒ…æ„Ÿè°ƒåˆ¶
6. âœ… GraphMemory ç±»å›¾çŸ¥è¯†å­˜å‚¨
7. âš ï¸ Backtracker è‡ªæˆ‘å›æº¯ (åŸºç¡€æ¡†æ¶)
8. âš ï¸ WebSearch è”ç½‘æœç´¢ (DuckDuckGo é›†æˆ)

### ä¸‹ä¸€æ­¥é‡ç‚¹ ğŸ¯

1. **ç«¯åˆ°ç«¯è®­ç»ƒéªŒè¯** - ä½¿ç”¨çœŸå®æ•°æ®éªŒè¯è®­ç»ƒæµç¨‹
2. **è§£ç å™¨ç”Ÿæˆè´¨é‡** - æå‡è¾“å‡ºæ–‡æœ¬è´¨é‡
3. **è®°å¿†ç³»ç»Ÿå®Œæ•´é›†æˆ** - åœ¨æ¨ç†ä¸­å……åˆ†åˆ©ç”¨è®°å¿†

### æ¶æ„å¯¹é½åº¦ ğŸ“Š

```
åŸå§‹è®¾æƒ³å¯¹é½: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘ 80%
ä»£ç å®ç°:     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 85%
å¯ç”¨æ€§:       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘ 75%
```

---

> **æ–‡æ¡£æ›´æ–°**: 2026-01-15
> **åˆ†æäºº**: AI Assistant
> **ä¸‹æ¬¡è¯„å®¡å»ºè®®**: å®Œæˆ D1~D3 ä»»åŠ¡å
